{% extends 'admin/base.html' %}

{% block title %}æŸ¥çœ‹è¯ä¹¦ - è¯ä¹¦ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block page_title %}æŸ¥çœ‹è¯ä¹¦{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="#">è¯ä¹¦ç®¡ç†</a></li>
<li class="breadcrumb-item"><a href="{{ url_for('my_certs.index') }}">æˆ‘çš„è¯ä¹¦</a></li>
<li class="breadcrumb-item active">æŸ¥çœ‹</li>
{% endblock %}

{% block body %}
<div class="row">
    <!-- å·¦ä¾§ï¼šè¯ä¹¦æ–‡ä»¶é¢„è§ˆ -->
    <div class="col-md-5">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-image"></i> è¯ä¹¦æ–‡ä»¶</h3>
            </div>
            <div class="card-body text-center">
                {% if cert.file_path %}
                    {% if cert.file_path.lower().endswith(('.jpg', '.jpeg', '.png', '.bmp')) %}
                    <img src="{{ url_for('api.get_certificate_file', cert_id=cert.cert_id) }}"
                        alt="è¯ä¹¦å›¾ç‰‡" class="img-fluid" style="max-height: 500px;">
                    {% else %}
                    <div class="alert alert-info mb-0">
                        <i class="fas fa-file-pdf fa-3x"></i>
                        <p class="mt-2 mb-0">PDFæ–‡ä»¶</p>
                        <a href="{{ url_for('api.get_certificate_file', cert_id=cert.cert_id) }}" target="_blank" class="btn btn-sm btn-primary mt-2">
                            <i class="fas fa-external-link-alt"></i> æ‰“å¼€æŸ¥çœ‹
                        </a>
                    </div>
                    {% endif %}
                {% else %}
                <div class="text-muted">
                    <i class="fas fa-image fa-3x"></i>
                    <p class="mt-2 mb-0">æš‚æ— è¯ä¹¦æ–‡ä»¶</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- è¯ä¹¦åŸºæœ¬ä¿¡æ¯ -->
        <div class="card card-secondary">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-info-circle"></i> åŸºæœ¬ä¿¡æ¯</h3>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-5">å½“å‰çŠ¶æ€</dt>
                    <dd class="col-sm-7">
                        {% if cert.status == 'draft' %}
                        <span class="badge badge-warning">ğŸ“ è‰ç¨¿</span>
                        {% elif cert.status == 'pending_teacher' %}
                        <span class="badge badge-info">â³ å¾…æ•™å¸ˆå®¡æ ¸</span>
                        {% elif cert.status == 'pending_admin' %}
                        <span class="badge badge-primary">â³ å¾…ç®¡ç†å‘˜å®¡æ ¸</span>
                        {% elif cert.status == 'approved' %}
                        <span class="badge badge-success">âœ… å®¡æ ¸é€šè¿‡</span>
                        {% else %}
                        <span class="badge badge-secondary">{{ cert.status }}</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-5">åˆ›å»ºæ—¶é—´</dt>
                    <dd class="col-sm-7">{{ cert.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>

                    {% if current_user.role not in ['student'] %}
                    <dt class="col-sm-5">æ ‡å‡†åˆ†å€¼</dt>
                    <dd class="col-sm-7">
                        {% if cert.standard_score %}
                        <span class="badge badge-primary">{{ cert.standard_score }}</span>
                        {% else %}
                        <span class="text-muted">æœªè¯„åˆ†</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-5">è´¡çŒ®åº¦</dt>
                    <dd class="col-sm-7">
                        {% if cert.contribution %}
                        <span class="badge badge-success">{{ cert.contribution }}</span>
                        {% else %}
                        <span class="text-muted">æœªè¯„ä¼°</span>
                        {% endif %}
                    </dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>

    <!-- å³ä¾§ï¼šè¯ä¹¦è¯¦æƒ… -->
    <div class="col-md-7">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-eye"></i> è¯ä¹¦è¯¦æƒ…</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>å­¦å·</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.student_id or '-' }}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>å­¦ç”Ÿå§“å</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.student_name or '-' }}</p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>å­¦é™¢</label>
                    <p class="form-control-static bg-light p-2 rounded">{{ cert.department or '-' }}</p>
                </div>

                <div class="form-group">
                    <label>ç«èµ›é¡¹ç›®</label>
                    <p class="form-control-static bg-light p-2 rounded">{{ cert.competition_name or '-' }}</p>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>è·å¥–ç±»åˆ«</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.award_category or '-' }}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>è·å¥–ç­‰çº§</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.award_level or '-' }}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>ç«èµ›ç±»å‹</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.competition_type or '-' }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group">
                            <label>ä¸»åŠå•ä½</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.organizer or '-' }}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>è·å¥–æ—¶é—´</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.award_date or '-' }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>æŒ‡å¯¼æ•™å¸ˆ</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.advisor or '-' }}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>æŒ‡å¯¼è€å¸ˆå·¥å·</label>
                            <p class="form-control-static bg-light p-2 rounded">{{ cert.advisor_id or '-' }}</p>
                        </div>
                    </div>
                </div>

                {% if current_user.role not in ['student'] %}
                <hr>
                <h5><i class="fas fa-star text-warning"></i> è¯„åˆ†ä¿¡æ¯</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>æ ‡å‡†åˆ†å€¼</label>
                            <p class="form-control-static bg-light p-2 rounded">
                                {% if cert.standard_score %}
                                <span class="badge badge-primary">{{ cert.standard_score }}</span>
                                {% else %}
                                <span class="text-muted">æœªè¯„åˆ†</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>è´¡çŒ®åº¦</label>
                            <p class="form-control-static bg-light p-2 rounded">
                                {% if cert.contribution %}
                                <span class="badge badge-success">{{ cert.contribution }}</span>
                                {% else %}
                                <span class="text-muted">æœªè¯„ä¼°</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{{ url_for('my_certs.index') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> è¿”å›åˆ—è¡¨
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
